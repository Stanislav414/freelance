import{_ as b,c as l,b as e,i as h,F as p,r as v,h as u,t as n,j as _,v as m,o as d}from"./index-BoqY_lBJ.js";const g={name:"TariffTable",props:{workTypeId:{type:Number,required:!0}},data(){return{selectedTariff:null,selectedServices:{},selectedOptions:{},totalPrice:0,tariffs:[],services:[],additionalOptions:[],servicePrices:{},loading:!1}},methods:{selectTariff(t){this.selectedTariff=t,this.updateTotalPrice()},toggleService(t,s){if(s!==this.selectedTariff)return;const r=`${t}-${s}`;this.selectedServices[r]?delete this.selectedServices[r]:this.selectedServices[r]=!0,this.updateTotalPrice()},isServiceSelected(t,s){return!!this.selectedServices[`${t}-${s}`]},getServicePrice(t,s){var r;return((r=this.servicePrices[t])==null?void 0:r[s])||0},updateTotalPrice(){let t=0;Object.keys(this.selectedServices).forEach(s=>{const[r,a]=s.split("-").map(Number);this.selectedServices[s]&&(t+=this.getServicePrice(r,a))}),Object.keys(this.selectedOptions).forEach(s=>{if(this.selectedOptions[s]){const r=this.additionalOptions.find(a=>a.id===Number(s));r&&(t+=r.price)}}),this.totalPrice=t,this.$emit("price-updated",t)},getSelectedServices(){const t=[];return Object.keys(this.selectedServices).forEach(s=>{if(this.selectedServices[s]){const[r,a]=s.split("-").map(Number);t.push({serviceId:r,tariffId:a,price:this.getServicePrice(r,a)})}}),t},getSelectedOptions(){return Object.keys(this.selectedOptions).filter(t=>this.selectedOptions[t]).map(t=>Number(t))},async loadTariffData(){if(this.workTypeId)try{this.loading=!0,console.log("Загружаем тарифные данные для workTypeId:",this.workTypeId);const t=await fetch("/api/tariffs");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);this.tariffs=await t.json(),console.log("Загружены тарифы:",this.tariffs);const s=await fetch(`/api/tariffs/work-type/${this.workTypeId}/services`);if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const r=await s.json();this.services=r.services,console.log("Загружены услуги:",this.services),this.servicePrices={},this.services.forEach(o=>{this.servicePrices[o.id]=o.prices});const a=await fetch("/api/tariffs/additional-options");if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);this.additionalOptions=await a.json(),console.log("Загружены дополнительные опции:",this.additionalOptions),this.tariffs.length>0&&this.selectTariff(this.tariffs[0].id)}catch(t){console.error("Ошибка загрузки тарифных данных:",t),this.tariffs=[],this.services=[],this.additionalOptions=[]}finally{this.loading=!1}}},async mounted(){await this.loadTariffData()},watch:{workTypeId:{handler:"loadTariffData",immediate:!0}}},T={class:"tariff-table-container"},k={key:0,class:"loading-indicator bg-[#16243a] rounded-2xl p-6 mb-6"},x={key:1,class:"error-message bg-red-900 rounded-2xl p-6 mb-6"},y={key:2,class:"tariff-table-wrapper bg-[#16243a] rounded-2xl p-6 mb-6"},w={class:"tariff-table"},S={class:"tariff-header-row"},P={class:"tariff-name"},O={class:"tariff-price"},j=["onClick"],I={class:"tariff-cell service-cell"},C={class:"service-info"},E={class:"service-name"},D={class:"service-description"},N={class:"price-amount"},V=["id","checked","onChange","disabled"],B=["for"],F={key:3,class:"additional-options bg-[#16243a] rounded-2xl p-6 mb-6"},H={class:"options-grid"},R={class:"option-info"},U={class:"option-name"},q={class:"option-description"},z={class:"option-controls"},L={class:"option-price"},M=["id","onUpdate:modelValue"],A=["for"],G={key:4,class:"total-price-section bg-[#0D1F31] rounded-2xl p-6"},J={class:"total-price-content"},K={class:"total-price-amount"},Q={class:"total-price-value"};function W(t,s,r,a,o,f){return d(),l("div",T,[s[7]||(s[7]=e("div",{class:"tariff-table-header mb-6"},[e("h3",{class:"text-xl font-bold text-white mb-2"},"Выберите услуги и тариф"),e("p",{class:"text-gray-400 text-sm"},"Отметьте нужные услуги для расчета стоимости")],-1)),o.loading?(d(),l("div",k,s[1]||(s[1]=[e("div",{class:"flex items-center justify-center"},[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e("span",{class:"ml-3 text-white"},"Загрузка тарифов...")],-1)]))):o.tariffs.length===0&&!o.loading?(d(),l("div",x,s[2]||(s[2]=[e("div",{class:"text-red-200"},[e("h4",{class:"font-semibold mb-2"},"Ошибка загрузки тарифов"),e("p",{class:"text-sm"},"Не удалось загрузить данные о тарифах. Попробуйте обновить страницу.")],-1)]))):h("",!0),!o.loading&&o.tariffs.length>0?(d(),l("div",y,[e("div",w,[e("div",S,[s[3]||(s[3]=e("div",{class:"tariff-cell service-header"},[e("span",{class:"text-gray-400 text-sm"},"Услуги")],-1)),(d(!0),l(p,null,v(o.tariffs,i=>(d(),l("div",{key:i.id,class:u(["tariff-cell tariff-header",{selected:o.selectedTariff===i.id}])},[e("div",P,n(i.name),1),e("div",O,n(i.basePrice)+"₽",1),e("button",{onClick:c=>f.selectTariff(i.id),class:u(["tariff-select-btn",{selected:o.selectedTariff===i.id}])},n(o.selectedTariff===i.id?"Выбрано":"Выбрать"),11,j)],2))),128))]),(d(!0),l(p,null,v(o.services,i=>(d(),l("div",{key:i.id,class:"tariff-row"},[e("div",I,[e("div",C,[e("div",E,n(i.name),1),e("div",D,n(i.description),1)])]),(d(!0),l(p,null,v(o.tariffs,c=>(d(),l("div",{key:c.id,class:u(["tariff-cell price-cell",{selected:o.selectedTariff===c.id}])},[e("div",N,n(f.getServicePrice(i.id,c.id))+"₽",1),e("input",{type:"checkbox",id:`service-${i.id}-tariff-${c.id}`,checked:f.isServiceSelected(i.id,c.id),onChange:X=>f.toggleService(i.id,c.id),class:"service-checkbox",disabled:o.selectedTariff!==c.id},null,40,V),e("label",{for:`service-${i.id}-tariff-${c.id}`,class:u(["service-checkbox-label",{disabled:o.selectedTariff!==c.id}])},null,10,B)],2))),128))]))),128))])])):h("",!0),!o.loading&&o.additionalOptions.length>0?(d(),l("div",F,[s[4]||(s[4]=e("h4",{class:"text-lg font-semibold text-white mb-4"},"Дополнительные опции",-1)),e("div",H,[(d(!0),l(p,null,v(o.additionalOptions,i=>(d(),l("div",{key:i.id,class:"option-item"},[e("div",R,[e("div",U,n(i.name),1),e("div",q,n(i.description),1)]),e("div",z,[e("div",L,n(i.price)+"₽",1),_(e("input",{type:"checkbox",id:`option-${i.id}`,"onUpdate:modelValue":c=>o.selectedOptions[i.id]=c,onChange:s[0]||(s[0]=(...c)=>f.updateTotalPrice&&f.updateTotalPrice(...c)),class:"option-checkbox"},null,40,M),[[m,o.selectedOptions[i.id]]]),e("label",{for:`option-${i.id}`,class:"option-checkbox-label"},null,8,A)])]))),128))])])):h("",!0),o.loading?h("",!0):(d(),l("div",G,[e("div",J,[s[6]||(s[6]=e("div",{class:"total-price-info"},[e("h4",{class:"text-lg font-semibold text-white"},"Итоговая стоимость"),e("p",{class:"text-gray-400 text-sm"},"Включает выбранные услуги и опции")],-1)),e("div",K,[e("span",Q,n(o.totalPrice)+"₽",1),s[5]||(s[5]=e("span",{class:"total-price-note"},"*третья и каждая последующая правка 250 рублей",-1))])])]))])}const Z=b(g,[["render",W],["__scopeId","data-v-d28c8ab9"]]);export{Z as default};
